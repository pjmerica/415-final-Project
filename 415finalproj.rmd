---
title: "415finalproject"
author: "Paul Merica"
date: "November 17, 2019"
output: html_document
---

# Libraries
```{r}
library(corrplot)
```

```{r}
lifeexpect = read.csv("Life Expectancy Data.csv", stringsAsFactors = F)

newlife = na.omit(lifeexpect)
newlife = newlife[-c(12,19)] #Getting rid of variables with collinearity
newlife$Year = as.factor(newlife$Year)
newlife$Status = as.factor(newlife$Status)

names(newlife)[names(newlife) == "Life.expectancy"] = "Life_Expectancy"
names(newlife)[names(newlife) == "Adult.Mortality"] = "Adult_Mortality"
names(newlife)[names(newlife) == "infant.deaths"] = "Infant_Deaths"
names(newlife)[names(newlife) == "percentage.expenditure"] = "Percentage_Expenditure"
names(newlife)[names(newlife) == "Hepatitis.B"] = "HepatitisB"
names(newlife)[names(newlife) == "Total.expenditure"] = "Total_Expenditure"
names(newlife)[names(newlife) == "Income.composition.of.resources"] = "Resource_Income"
```

```{r}
par(mfrow=c(2,2))
plot(newlife$Life_Expectancy ~ newlife$Status, xlab = "Status", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Adult_Mortality, xlab = "Adult Mortality", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Infant_Deaths, xlab = "Infant Deaths", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Alcohol, xlab = "Alcohol", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Percentage_Expenditure, xlab = "Percentage Expenditure", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$HepatitisB, xlab = "Hepatitis B", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Measles, xlab = "Measles", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$BMI, xlab = "BMI", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Polio, xlab = "Polio", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Total_Expenditure, xlab = "Total Expenditure", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Diphtheria, xlab = "Diphtheria", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$HIV.AIDS, xlab = "HIV/AIDS", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$GDP, xlab = "GDP", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Population, xlab = "Population", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$thinness.5.9.years, xlab = "Thinness 5-9 years", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Resource_Income, xlab = "Income Composition of Resources", ylab = "Life Expectancy")
plot(newlife$Life_Expectancy ~ newlife$Schooling, xlab = "Schooling", ylab = "Life Expectancy")
summary(lm(Life_Expectancy ~ Status, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ Adult_Mortality, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ BMI, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ Polio, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ Diphtheria, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ HIV.AIDS, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ Resource_Income, data = newlife))$r.squared
summary(lm(Life_Expectancy ~ Schooling, data = newlife))$r.squared

cor(newlife$Adult_Mortality, newlife$Life_Expectancy)
cor(newlife$BMI, newlife$Life_Expectancy)
cor(newlife$Polio, newlife$Life_Expectancy)
cor(newlife$Diphtheria, newlife$Life_Expectancy)
cor(newlife$HIV.AIDS, newlife$Life_Expectancy)
cor(newlife$Resource_Income, newlife$Life_Expectancy)
cor(newlife$Schooling, newlife$Life_Expectancy)

newlife.cor = cor(newlife[-c(1,2,3)])
corrplot(newlife.cor)

palette = colorRampPalette(c("green", "white", "red")) (20)
heatmap(x = newlife.cor, col = palette, symm = TRUE)
```

When plotting all the predictors against life expectancy in a scatter plot, life expectancy seems to be most correlated with status of the country, adult mortality, BMI, polio immunization coverage (%), diphtheria,  HIV/AIDS, income composition of resources, and schooling. In most of the scatterplots, there appears to be a lot of outliers. However, this may be due to getting rid of the NA values in the data set in the data cleaning process. When looking at the in sample r-squared and the correlation coefficients for the relationship between these 8 predictors and life expectancy, the five most strongly predictive features of life expectancy are adult mortality, BMI, HIV/AIDS, income composition of resources, and schooling with schooling being the top most predictive feature of life expectancy.

# Linear Regression Method
```{r}
trainlife = newlife[1:floor(0.7*nrow(newlife)),]
testlife = newlife[-(1:floor(0.7*nrow(newlife))),]

colMeans(newlife[-c(1,2,3)])
apply(newlife[-c(1,2,3)], 2, sd)
# The means and standard deviations of the design matrix vary significantly, therefore, it is imperative to standardize the data.

mean_train = colMeans(trainlife[-c(1,2,3)])
std_train = apply(trainlife[-c(1,2,3)], 2, sd)

X_life_train = scale(trainlife[-c(1,2,3)], center = mean_train, scale = std_train)
y_life_train = trainlife$Life_expectancy

X_life_test = scale(testlife[-c(1,2,3)], center = mean_train, scale = std_train)
y_life_test = testlife$Life_expectancy

mod1 = lm(Life_Expectancy ~ Adult_Mortality + BMI + HIV.AIDS + Resource_Income + Schooling, data = trainlife)
summary(mod1)
plot(mod1)
mod2 = lm(Life_Expectancy ~ . - Status - Year - Country, data = trainlife)
summary(mod2)

# Training and Test Errors
train_predict = predict.lm(mod1, trainlife)
train_mse = mean((train_predict - trainlife$Life_Expectancy)^2)

test_predict = predict.lm(mod1, testlife)
test_mse = mean((test_predict - testlife$Life_Expectancy)^2)

cat("The training MSE for the model fit by OLS is", train_mse,".\n")
cat("The test MSE for the model fit by OLS is", test_mse,".\n")
```

